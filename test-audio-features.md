# 语音功能测试指南

## 功能概述
已成功实现语音转文本和文本转语音功能，集成到聊天界面中。

## 实现的功能

### 后端功能
1. **语音转文本API** (`/api/audio/speech-to-text`)
   - 接收音频文件 (WebM格式)
   - 调用SiliconFlow的Whisper-1模型
   - 返回转录文本

2. **文本转语音API** (`/api/audio/text-to-speech`)
   - 接收文本内容
   - 调用SiliconFlow的TTS-1模型
   - 返回MP3音频文件

### 前端功能
1. **语音录制组件** (`VoiceRecorder`)
   - 录音按钮和控制界面
   - 实时录音时长显示
   - 暂停/继续录音功能
   - 录音预览和发送

2. **语音播放组件** (`VoicePlayer`)
   - AI回复消息的语音播放按钮
   - 自动生成和缓存音频
   - 播放状态指示

3. **聊天界面集成**
   - 输入框右侧的语音录制按钮
   - AI消息旁的语音播放按钮
   - 无缝的语音转文本流程

## 测试步骤

### 1. 启动应用
```bash
# 启动后端
./start-dev.sh

# 启动前端
cd frontend
npm start
```

### 2. 测试语音转文本
1. 进入聊天界面
2. 点击输入框右侧的麦克风图标
3. 允许浏览器访问麦克风权限
4. 开始说话录制语音
5. 点击停止录制
6. 点击发送按钮，查看语音是否正确转换为文本

### 3. 测试文本转语音
1. 发送一条消息给AI
2. 等待AI回复
3. 点击AI回复消息旁的小喇叭图标
4. 验证是否播放AI回复的语音

## 技术细节

### API端点
- `POST /api/audio/speech-to-text` - 语音转文本
- `POST /api/audio/text-to-speech` - 文本转语音

### 支持的格式
- 录音格式：WebM (opus编码)
- 输出格式：MP3
- 语言支持：中文 (zh) 和其他语言

### 配置要求
- SiliconFlow API密钥已配置在 `application.yml` 中
- 浏览器需要支持WebRTC和MediaRecorder API
- 需要麦克风权限

## 注意事项
1. 确保SiliconFlow API密钥有效且有足够余额
2. 录音功能需要HTTPS环境或localhost
3. 音频文件会临时缓存，页面刷新后清除
4. 语音转文本支持中文，可通过参数调整语言
5. 文本转语音支持多种语音风格，默认使用'alloy'

## 可能的改进
1. 添加语音识别的实时反馈
2. 支持更多语音风格选择
3. 添加音频质量和速度设置
4. 实现语音命令功能
5. 添加语音消息的可视化波形显示
